---
import { languages } from '../../i18n/ui';
import { getLangFromUrl } from '../../i18n/utils';
import { Icon } from 'astro-icon/components';

const lang = getLangFromUrl(Astro.url);
const currentLang = languages[lang as keyof typeof languages];

// Generate alternative language URL
const otherLang = lang === 'es' ? 'en' : 'es';
const newPath = lang === 'es' ? `/en${Astro.url.pathname === '/' ? '' : Astro.url.pathname}` : Astro.url.pathname.replace('/en', '') || '/';
---

<div class="relative inline-block text-left group">
  <button
    type="button"
    class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-text-muted hover:text-text rounded-md transition-colors"
    aria-haspopup="true"
    aria-expanded="false"
  >
    <Icon name="lucide:globe" class="w-5 h-5 text-primary" />
    <span class="hidden sm:inline uppercase">{lang}</span>
    <Icon name="lucide:chevron-down" class="w-4 h-4 transition-transform group-hover:rotate-180" />
  </button>

  <div
    class="absolute right-0 mt-2 w-32 origin-top-right rounded-md bg-surface border border-border shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 overflow-hidden"
  >
    <div class="py-1" role="none">
      {
        Object.entries(languages).map(([l, label]) => (
          <a
            href={l === 'es' ? '/' : `/${l}`}
            class:list={[
              'flex items-center gap-3 px-4 py-2 text-sm transition-colors',
              l === lang ? 'bg-primary/10 text-primary pointer-events-none' : 'text-text-muted hover:bg-background hover:text-text'
            ]}
            role="menuitem"
          >
            <span>{l === 'es' ? 'ðŸ‡ªðŸ‡¸' : 'ðŸ‡ºðŸ‡¸'}</span>
            {label}
          </a>
        ))
      }
    </div>
  </div>
</div>
