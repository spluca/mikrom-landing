---
/**
 * StorySection - Inspirational narrative section with parallax and scroll reveal
 */
import { getLangFromUrl, useTranslations } from '@/i18n/utils';

interface Props {
  image: string;
}

const { image } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section class="relative min-h-[80vh] flex items-center overflow-hidden">
  <!-- Parallax Background -->
  <div class="absolute inset-0 z-0">
    <div 
      class="parallax-bg absolute inset-0 w-full h-[120%] -top-[10%] bg-cover bg-center"
      style={`background-image: url('${image}');`}
    ></div>
    <div class="absolute inset-0 bg-black/60 backdrop-blur-[2px]"></div>
  </div>

  <div class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
    <div class="space-y-12">
      <p class="reveal-text text-2xl md:text-4xl font-light leading-relaxed text-white/90">
        {t('story.p1').split('{span1}')[0]}<span class="text-primary font-semibold">{t('story.span1')}</span>{t('story.p1').split('{span1}')[1]}
      </p>
      
      <p class="reveal-text delay-300 text-xl md:text-3xl font-light leading-relaxed text-white/80 italic">
        {t('story.p2')}
      </p>

      <div class="reveal-text delay-700 pt-8 border-t border-white/10">
        <p class="text-lg md:text-2xl font-medium text-white">
          {t('story.footer').split('{span2}')[0]}<span class="text-secondary">{t('story.span2')}</span>{t('story.footer').split('{span2}')[1] || ''}
        </p>
      </div>
    </div>
  </div>
</section>

<style>
  .reveal-text {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .reveal-text.active {
    opacity: 1;
    transform: translateY(0);
  }

  .delay-300 { transition-delay: 0.3s; }
  .delay-700 { transition-delay: 0.6s; }
</style>

<script>
  function initScrollEffects() {
    const observerOptions = {
      threshold: 0.2
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        }
      });
    }, observerOptions);

    document.querySelectorAll('.reveal-text').forEach(el => observer.observe(el));

    // Simple Parallax
    window.addEventListener('scroll', () => {
      const scrolled = window.scrollY;
      const bg = document.querySelector('.parallax-bg') as HTMLElement;
      if (bg) {
        const offset = bg.parentElement?.offsetTop || 0;
        const relativeScroll = scrolled - offset;
        bg.style.transform = `translateY(${relativeScroll * 0.15}px)`;
      }
    });
  }

  // Initialize on load and on Astro page changes
  initScrollEffects();
  document.addEventListener('astro:page-load', initScrollEffects);
</script>
