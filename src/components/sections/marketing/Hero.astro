---
/**
 * Hero - Landing page hero section with flexible background options
 *
 * @description
 * A full-width hero section designed for landing pages. Includes a main headline,
 * supporting subtitle text, and up to two call-to-action buttons. Supports multiple
 * background types: solid color, gradient, image, or video.
 *
 * @example Default (solid background)
 * ```astro
 * <Hero
 *   title="Ship faster. Scale effortlessly."
 *   subtitle="The modern deployment platform for teams."
 *   primaryCTA={{ label: "Get Started", href: "/signup" }}
 * />
 * ```
 *
 * @example With gradient background
 * ```astro
 * <Hero
 *   title="Ship faster"
 *   subtitle="The modern platform for teams."
 *   primaryCTA={{ label: "Get Started", href: "/signup" }}
 *   backgroundType="gradient"
 *   gradient="from-primary/20 via-background to-background"
 * />
 * ```
 *
 * @example With image background
 * ```astro
 * <Hero
 *   title="Ship faster"
 *   subtitle="The modern platform for teams."
 *   primaryCTA={{ label: "Get Started", href: "/signup" }}
 *   backgroundType="image"
 *   backgroundImage="/images/hero-bg.jpg"
 *   overlay={true}
 *   overlayOpacity={60}
 * />
 * ```
 *
 * @example With video background
 * ```astro
 * <Hero
 *   title="Ship faster"
 *   subtitle="The modern platform for teams."
 *   primaryCTA={{ label: "Get Started", href: "/signup" }}
 *   backgroundType="video"
 *   backgroundVideo="/videos/hero-bg.mp4"
 *   backgroundVideoPoster="/images/hero-poster.jpg"
 *   overlay={true}
 * />
 * ```
 */

interface Props {
  /** Main headline text displayed prominently */
  title: string;
  /** Supporting text that appears below the headline */
  subtitle: string;
  /** Primary call-to-action button with label and link */
  primaryCTA: { label: string; href: string };
  /** Optional secondary call-to-action button */
  secondaryCTA?: { label: string; href: string };
  /** Background type */
  backgroundType?: 'solid' | 'gradient' | 'image' | 'video';
  /** Solid background style (when backgroundType is 'solid') */
  background?: 'default' | 'muted' | 'accent';
  /** Gradient classes (when backgroundType is 'gradient') */
  gradient?: string;
  /** Background image URL (when backgroundType is 'image') */
  backgroundImage?: string;
  /** Background video URL (when backgroundType is 'video') */
  backgroundVideo?: string;
  /** Video poster image for loading state */
  backgroundVideoPoster?: string;
  /** Show dark overlay on image/video backgrounds */
  overlay?: boolean;
  /** Overlay opacity percentage (0-100) */
  overlayOpacity?: number;
  /** Text color scheme for image/video backgrounds */
  textColor?: 'auto' | 'light' | 'dark';
  /** Minimum height for the hero section */
  minHeight?: 'default' | 'screen' | 'large';
  /** Content alignment */
  align?: 'center' | 'left';
  /** Optional badge text to show above title */
  badge?: string;
}

const {
  title,
  subtitle,
  primaryCTA,
  secondaryCTA,
  backgroundType = 'solid',
  background = 'default',
  gradient = 'from-primary/10 via-background to-background',
  backgroundImage,
  backgroundVideo,
  backgroundVideoPoster,
  overlay = false,
  overlayOpacity = 50,
  textColor = 'auto',
  minHeight = 'default',
  align = 'center',
  badge,
} = Astro.props;

// Solid background classes
const solidBgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

// Determine if we need light text (for dark backgrounds)
const needsLightText =
  textColor === 'light' ||
  (textColor === 'auto' && (backgroundType === 'image' || backgroundType === 'video') && overlay);

// Text color classes
const textClasses = needsLightText
  ? {
      heading: 'text-white',
      body: 'text-white/80',
      button: 'border-white/30 text-white hover:bg-white/10',
    }
  : {
      heading: 'text-text',
      body: 'text-text-muted',
      button: 'border-border text-text hover:bg-surface',
    };

// Min height classes
const minHeightClass = {
  default: 'py-section',
  large: 'py-24 md:py-32',
  screen: 'min-h-[80vh] flex items-center',
}[minHeight];

// Alignment classes
const alignClass = align === 'left' ? 'text-left' : 'text-center mx-auto';
const buttonAlignClass = align === 'left' ? 'justify-start' : 'justify-center';
---

<section
  class:list={[
    'relative overflow-hidden',
    minHeightClass,
    backgroundType === 'solid' && solidBgClass,
    backgroundType === 'gradient' && `bg-linear-to-br ${gradient}`,
  ]}
>
  {/* Image Background */}
  {
    backgroundType === 'image' && backgroundImage && (
      <div class="absolute inset-0 z-0">
        <img src={backgroundImage} alt="" class="w-full h-full object-cover" loading="eager" />
      </div>
    )
  }

  {/* Video Background */}
  {
    backgroundType === 'video' && backgroundVideo && (
      <div class="absolute inset-0 z-0">
        <video
          autoplay
          muted
          loop
          playsinline
          poster={backgroundVideoPoster}
          class="w-full h-full object-cover"
        >
          <source src={backgroundVideo} type="video/mp4" />
        </video>
      </div>
    )
  }

  {/* Overlay */}
  {
    overlay && (backgroundType === 'image' || backgroundType === 'video') && (
      <div class="absolute inset-0 z-1 bg-black" style={`opacity: ${overlayOpacity / 100}`} />
    )
  }

  {/* Content */}
  <div
    class:list={[
      'relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8',
      minHeight === 'screen' && 'w-full',
    ]}
  >
    <div class:list={['max-w-3xl', alignClass]}>
      {
        badge && (
          <div class="mb-6 inline-flex items-center rounded-full border border-primary/20 bg-primary/10 px-3 py-1 text-sm font-medium text-primary">
            {badge}
          </div>
        )
      }
      <h1
        id="hero-title"
        class:list={[
          'text-4xl sm:text-5xl lg:text-6xl font-bold leading-tight tracking-tight reveal-hero-title',
          textClasses.heading,
        ]}
      >
        {title}
      </h1>
      <p class:list={['mt-6 text-lg sm:text-xl leading-relaxed', textClasses.body]}>
        {subtitle}
      </p>
      <div class:list={['mt-10 flex flex-col sm:flex-row items-center gap-4', buttonAlignClass]}>
        <a
          href={primaryCTA.href}
          class="inline-flex items-center justify-center px-6 py-3 rounded-md bg-primary text-white font-medium hover:bg-primary-dark transition-colors w-full sm:w-auto"
        >
          {primaryCTA.label}
        </a>
        {
          secondaryCTA && (
            <a
              href={secondaryCTA.href}
              class:list={[
                'inline-flex items-center justify-center px-6 py-3 rounded-md border font-medium transition-colors w-full sm:w-auto',
                textClasses.button,
              ]}
            >
              {secondaryCTA.label}
            </a>
          )
        }
      </div>
    </div>
  </div>
</section>

<style>
  .reveal-hero-title {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 1.2s ease-out, transform 1.2s ease-out;
  }
  
  .reveal-hero-title.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  function initHeroParallax() {
    const title = document.getElementById('hero-title');
    if (!title) return;

    // Entry animation
    setTimeout(() => {
      title.classList.add('visible');
    }, 100);

    // Scroll parallax (slow)
    window.addEventListener('scroll', () => {
      const scrolled = window.scrollY;
      if (scrolled < 800) { // Only animate when in/near viewport
        title.style.transform = `translateY(${scrolled * 0.1}px)`;
      }
    });
  }

  // Initialize
  initHeroParallax();
  document.addEventListener('astro:page-load', initHeroParallax);
</script>
