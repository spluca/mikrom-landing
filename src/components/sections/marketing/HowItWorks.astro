---
/**
 * HowItWorks - Step-by-step process visualization
 *
 * @description
 * Displays a numbered step-by-step flow showing how the product works.
 * Common pattern in SaaS landing pages to explain the user journey.
 *
 * @example Basic usage
 * ```astro
 * <HowItWorks
 *   title="How it works"
 *   subtitle="Get started in 3 simple steps"
 *   steps={[
 *     { title: "Sign up", description: "Create your account in seconds" },
 *     { title: "Connect", description: "Link your repositories" },
 *     { title: "Deploy", description: "Push and go live instantly" },
 *   ]}
 * />
 * ```
 */

import { Icon } from 'astro-icon/components';

interface Step {
  /** Step title */
  title: string;
  /** Step description */
  description: string;
  /** Optional icon (Lucide icon name) */
  icon?: string;
  /** Optional image URL */
  image?: string;
}

interface Props {
  /** Section title */
  title?: string;
  /** Section subtitle */
  subtitle?: string;
  /** Array of steps */
  steps: Step[];
  /** Layout variant */
  variant?: 'horizontal' | 'vertical' | 'alternating';
  /** Show step numbers */
  showNumbers?: boolean;
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
}

const {
  title,
  subtitle,
  steps,
  variant = 'horizontal',
  showNumbers = true,
  background = 'default',
} = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const hasHeading = title || subtitle;
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      hasHeading && (
        <div class="text-center mb-16">
          {title && <h2 class="text-3xl sm:text-4xl font-bold text-text">{title}</h2>}
          {subtitle && <p class="mt-4 text-lg text-text-muted max-w-2xl mx-auto">{subtitle}</p>}
        </div>
      )
    }

    {/* Horizontal Layout */}
    {
      variant === 'horizontal' && (
        <div class="relative">
          {/* Connection line - positioned between first and last icon centers */}
          <div
            class="hidden md:block absolute top-12 h-0.5 bg-border"
            style="left: calc(16.666% + 48px); right: calc(16.666% + 48px);"
          />

          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
            {steps.map((step, index) => (
              <div class="relative text-center">
                {/* Step number or icon */}
                <div class="relative z-10 mx-auto w-24 h-24 flex items-center justify-center rounded-full bg-primary text-white text-2xl font-bold mb-6">
                  {step.icon ? (
                    <Icon name={step.icon} class="w-10 h-10" />
                  ) : showNumbers ? (
                    <span>{index + 1}</span>
                  ) : (
                    <Icon name="lucide:check" class="w-10 h-10" />
                  )}
                </div>

                {/* Optional image */}
                {step.image && (
                  <div class="mb-6 rounded-lg overflow-hidden border border-border">
                    <img src={step.image} alt={step.title} class="w-full h-auto" loading="lazy" />
                  </div>
                )}

                <h3 class="text-xl font-semibold text-text mb-3">{step.title}</h3>
                <p class="text-text-muted leading-relaxed">{step.description}</p>
              </div>
            ))}
          </div>
        </div>
      )
    }

    {/* Vertical Layout */}
    {
      variant === 'vertical' && (
        <div class="max-w-3xl mx-auto">
          <div class="relative pl-6">
            {/* Vertical line - aligned with icon center */}
            <div class="absolute left-6 top-6 bottom-6 w-1 bg-border -translate-x-1/2" />

            <div class="space-y-12">
              {steps.map((step, index) => (
                <div class="relative flex items-start gap-6">
                  {/* Step number */}
                  <div class="relative z-10 shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-primary text-white font-bold -ml-6">
                    {showNumbers ? (
                      index + 1
                    ) : step.icon ? (
                      <Icon name={step.icon} class="w-6 h-6" />
                    ) : (
                      <Icon name="lucide:check" class="w-6 h-6" />
                    )}
                  </div>

                  <div class="flex-1 pt-2">
                    <h3 class="text-xl font-semibold text-text mb-2">{step.title}</h3>
                    <p class="text-text-muted leading-relaxed">{step.description}</p>

                    {step.image && (
                      <div class="mt-4 rounded-lg overflow-hidden border border-border">
                        <img
                          src={step.image}
                          alt={step.title}
                          class="w-full h-auto"
                          loading="lazy"
                        />
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )
    }

    {/* Alternating Layout */}
    {
      variant === 'alternating' && (
        <div class="space-y-16 md:space-y-24">
          {steps.map((step, index) => (
            <div
              class:list={[
                'flex flex-col gap-8 items-center',
                index % 2 === 0 ? 'md:flex-row' : 'md:flex-row-reverse',
              ]}
            >
              {/* Content */}
              <div class="flex-1 text-center md:text-left">
                {showNumbers && (
                  <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-primary/10 text-primary font-bold text-lg mb-4">
                    {index + 1}
                  </span>
                )}
                <h3 class="text-2xl font-semibold text-text mb-4">{step.title}</h3>
                <p class="text-lg text-text-muted leading-relaxed">{step.description}</p>
              </div>

              {/* Image or Icon */}
              <div class="flex-1">
                {step.image ? (
                  <div class="rounded-xl overflow-hidden border border-border shadow-lg">
                    <img src={step.image} alt={step.title} class="w-full h-auto" loading="lazy" />
                  </div>
                ) : (
                  <div class="aspect-video rounded-xl bg-surface border border-border flex items-center justify-center">
                    {step.icon ? (
                      <Icon name={step.icon} class="w-24 h-24 text-primary/30" />
                    ) : (
                      <span class="text-8xl font-bold text-primary/20">{index + 1}</span>
                    )}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      )
    }
  </div>
</section>
