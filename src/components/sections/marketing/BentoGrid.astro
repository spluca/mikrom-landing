---
/**
 * BentoGrid - Modern bento-style feature grid
 *
 * @description
 * Displays features in a trendy bento box layout with varying card sizes.
 * Perfect for showcasing multiple features in an engaging visual format.
 *
 * @example Basic usage
 * ```astro
 * <BentoGrid
 *   title="Platform Features"
 *   items={[
 *     { title: "Fast Deploys", description: "...", icon: "lucide:zap", size: "large" },
 *     { title: "Auto Scaling", description: "...", icon: "lucide:trending-up" },
 *   ]}
 * />
 * ```
 */

import { Icon } from 'astro-icon/components';

interface BentoItem {
  /** Item title */
  title: string;
  /** Item description */
  description: string;
  /** Icon name */
  icon?: string;
  /** Image URL (alternative to icon) */
  image?: string;
  /** Card size */
  size?: 'small' | 'medium' | 'large';
  /** Accent color variant */
  accent?: 'primary' | 'blue' | 'green' | 'purple' | 'orange';
  /** Optional link */
  href?: string;
}

interface Props {
  /** Section title */
  title?: string;
  /** Section subtitle */
  subtitle?: string;
  /** Array of bento items */
  items: BentoItem[];
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
}

const { title, subtitle, items, background = 'default' } = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const accentColors = {
  primary: 'from-primary/20 to-primary/5 text-primary',
  blue: 'from-blue-500/20 to-blue-500/5 text-blue-500',
  green: 'from-green-500/20 to-green-500/5 text-green-500',
  purple: 'from-purple-500/20 to-purple-500/5 text-purple-500',
  orange: 'from-orange-500/20 to-orange-500/5 text-orange-500',
};

const hasHeading = title || subtitle;

// Determine grid placement based on size
const getGridClass = (size: string = 'small') => {
  if (size === 'large') return 'md:col-span-2 md:row-span-2';
  if (size === 'medium') return 'md:col-span-2';
  return '';
};
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      hasHeading && (
        <div class="text-center mb-12 opacity-0 translate-y-8 transition-all duration-1000 ease-out section-header">
          {title && <h2 class="text-3xl sm:text-4xl font-bold text-text">{title}</h2>}
          {subtitle && <p class="mt-4 text-lg text-text-muted max-w-2xl mx-auto">{subtitle}</p>}
        </div>
      )
    }

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 auto-rows-[minmax(180px,auto)]">
      {
        items.map((item, index) => {
          const accent = item.accent || 'primary';
          const Tag = item.href ? 'a' : 'div';

          return (
            <Tag
              href={item.href}
              class:list={[
                'group relative flex flex-col p-6 rounded-2xl border border-border bg-background overflow-hidden transition-all duration-300 opacity-0 translate-y-12 bento-item',
                item.href && 'hover:border-primary/50 hover:shadow-lg cursor-pointer',
                getGridClass(item.size),
              ]}
              style={`transition-duration: 800ms; transition-delay: ${index * 150}ms;`}
            >
              {/* Background gradient */}
              <div
                class:list={[
                  'absolute inset-0 bg-linear-to-br opacity-50 transition-opacity group-hover:opacity-70',
                  accentColors[accent],
                ]}
              />

              {/* Content */}
              <div class="relative z-10 flex flex-col h-full">
                {/* Icon or Image */}
                {item.image ? (
                  <div class="mb-4 -mx-6 -mt-6">
                    <img
                      src={item.image}
                      alt={item.title}
                      class="w-full h-32 object-cover"
                      loading="lazy"
                    />
                  </div>
                ) : (
                  item.icon && (
                    <div
                      class:list={[
                        'w-12 h-12 rounded-xl flex items-center justify-center mb-4',
                        `bg-linear-to-br ${accentColors[accent]}`,
                      ]}
                    >
                      <Icon name={item.icon} class="w-6 h-6" />
                    </div>
                  )
                )}

                <h3
                  class:list={[
                    'font-semibold text-text mb-2',
                    item.size === 'large' ? 'text-2xl' : 'text-lg',
                  ]}
                >
                  {item.title}
                </h3>

                <p
                  class:list={[
                    'text-text-muted leading-relaxed flex-1',
                    item.size === 'large' ? 'text-base' : 'text-sm',
                  ]}
                >
                  {item.description}
                </p>

                {item.href && (
                  <div class="mt-4 flex items-center gap-1 text-sm font-medium text-primary opacity-0 group-hover:opacity-100 transition-opacity">
                    Learn more
                    <Icon name="lucide:arrow-right" class="w-4 h-4" />
                  </div>
                )}
              </div>
            </Tag>
          );
        })
      }
    </div>
  </div>
</section><style>
  .section-header.visible,
  .bento-item.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  function initBentoReveal() {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    document.querySelectorAll('.section-header, .bento-item').forEach(el => observer.observe(el));
  }

  initBentoReveal();
  document.addEventListener('astro:page-load', initBentoReveal);
</script>
