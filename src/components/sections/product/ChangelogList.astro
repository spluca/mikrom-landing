---
/**
 * ChangelogList - Changelog entries timeline display
 *
 * @description
 * Displays changelog entries in a timeline format with version badges,
 * dates, and rendered markdown content.
 *
 * @example Basic usage
 * ```astro
 * <ChangelogList
 *   entries={changelogEntries}
 * />
 * ```
 */

import { render, type CollectionEntry } from 'astro:content';

type ChangelogEntry = CollectionEntry<'changelog'>;
type ChangelogType = 'major' | 'minor' | 'patch';

interface Props {
  /** Array of changelog collection entries */
  entries: ChangelogEntry[];
  /** Message to show when no entries */
  emptyMessage?: string;
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
}

const { entries, emptyMessage = 'No changelog entries yet.', background = 'default' } = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const typeColors: Record<ChangelogType, string> = {
  major: 'bg-primary text-white',
  minor: 'bg-secondary text-white',
  patch: 'bg-text-muted/20 text-text',
};

const typeLabels: Record<ChangelogType, string> = {
  major: 'Major',
  minor: 'Minor',
  patch: 'Patch',
};
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      entries.length > 0 ? (
        <div class="space-y-12">
          {entries.map(async (entry: ChangelogEntry) => {
            const { Content } = await render(entry);
            const entryType = entry.data.type as ChangelogType;
            return (
              <article class="relative pl-8 border-l-2 border-border">
                <div class="absolute -left-2 top-0 w-4 h-4 rounded-full bg-primary border-4 border-background" />

                <div class="flex flex-wrap items-center gap-3 mb-4">
                  <span
                    class:list={[
                      'px-2.5 py-0.5 text-sm font-medium rounded-full',
                      typeColors[entryType],
                    ]}
                  >
                    {typeLabels[entryType]}
                  </span>
                  <span class="text-sm font-mono text-text-muted">v{entry.data.version}</span>
                  <span class="text-sm text-text-muted">
                    {entry.data.date.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </span>
                </div>

                <h2 class="text-2xl font-bold text-text mb-4">{entry.data.title}</h2>

                <div class="prose prose-text max-w-none">
                  <Content />
                </div>
              </article>
            );
          })}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-text-muted">{emptyMessage}</p>
        </div>
      )
    }
  </div>
</section>
