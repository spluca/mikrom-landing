---
/**
 * JobListings - Job openings display section
 *
 * @description
 * Displays job openings in a list format with department, location,
 * and type information. Includes empty state and contact fallback.
 *
 * @example Basic usage
 * ```astro
 * <JobListings
 *   title="Open positions"
 *   jobs={[
 *     { title: "Senior Engineer", department: "Engineering", location: "Remote", type: "Full-time", href: "/jobs/senior-engineer" },
 *   ]}
 * />
 * ```
 */

import { Icon } from 'astro-icon/components';

interface Job {
  /** Job title */
  title: string;
  /** Department name */
  department: string;
  /** Location (e.g., "Remote", "San Francisco") */
  location: string;
  /** Employment type (e.g., "Full-time", "Part-time") */
  type: string;
  /** Link to job posting */
  href: string;
}

interface Props {
  /** Optional section title */
  title?: string;
  /** Optional section subtitle */
  subtitle?: string;
  /** Array of job openings */
  jobs: Job[];
  /** Message to show when no jobs available */
  emptyMessage?: string;
  /** Contact email for general applications */
  contactEmail?: string;
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
}

const {
  title,
  subtitle,
  jobs,
  emptyMessage = 'No open positions at the moment. Check back soon!',
  contactEmail,
  background = 'default',
} = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const departments = [...new Set(jobs.map((job) => job.department))];
const hasHeading = title || subtitle;
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      hasHeading && (
        <div class="mb-8">
          {title && <h2 class="text-2xl sm:text-3xl font-bold text-text">{title}</h2>}
          {subtitle && <p class="mt-2 text-text-muted">{subtitle}</p>}
          {jobs.length > 0 && (
            <p class="mt-2 text-text-muted">
              {jobs.length} open {jobs.length === 1 ? 'position' : 'positions'} across{' '}
              {departments.length} {departments.length === 1 ? 'department' : 'departments'}
            </p>
          )}
        </div>
      )
    }

    {
      jobs.length > 0 ? (
        <div class="space-y-4">
          {jobs.map((job) => (
            <a
              href={job.href}
              class="block p-6 rounded-lg border border-border hover:border-primary transition-colors group"
            >
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                  <h3 class="text-lg font-semibold text-text group-hover:text-primary transition-colors">
                    {job.title}
                  </h3>
                  <div class="flex flex-wrap gap-3 mt-2 text-sm text-text-muted">
                    <span>{job.department}</span>
                    <span>•</span>
                    <span>{job.location}</span>
                    <span>•</span>
                    <span>{job.type}</span>
                  </div>
                </div>
                <div class="flex-shrink-0">
                  <span class="inline-flex items-center gap-1 text-primary font-medium">
                    Apply
                    <Icon name="lucide:chevron-right" class="w-4 h-4" />
                  </span>
                </div>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-12 px-4 rounded-lg border border-border">
          <p class="text-text-muted">{emptyMessage}</p>
        </div>
      )
    }

    {
      contactEmail && (
        <div class="mt-12 p-6 rounded-lg bg-surface border border-border">
          <h3 class="text-lg font-semibold text-text">Don't see a role that fits?</h3>
          <p class="mt-2 text-text-muted">
            We're always looking for talented people. Send your resume to{' '}
            <a href={`mailto:${contactEmail}`} class="text-primary hover:underline">
              {contactEmail}
            </a>{' '}
            and tell us how you'd like to contribute.
          </p>
        </div>
      )
    }
  </div>
</section>
