---
/**
 * FAQSection - Accordion FAQ section
 *
 * @description
 * Displays frequently asked questions in an expandable accordion format.
 * Supports optional categories for grouping questions.
 *
 * @example Basic usage
 * ```astro
 * <FAQSection
 *   title="Frequently Asked Questions"
 *   faqs={[
 *     { question: "How does it work?", answer: "..." },
 *     { question: "What's included?", answer: "..." },
 *   ]}
 * />
 * ```
 *
 * @example With categories
 * ```astro
 * <FAQSection
 *   title="FAQ"
 *   categories={[
 *     { name: "General", faqs: [...] },
 *     { name: "Billing", faqs: [...] },
 *   ]}
 * />
 * ```
 */

import { Icon } from 'astro-icon/components';

interface FAQ {
  question: string;
  answer: string;
}

interface FAQCategory {
  name: string;
  faqs: FAQ[];
}

interface Props {
  /** Optional section title */
  title?: string;
  /** Optional section subtitle */
  subtitle?: string;
  /** Simple FAQ list (use this OR categories, not both) */
  faqs?: FAQ[];
  /** Categorized FAQs */
  categories?: FAQCategory[];
  /** FAQ display variant */
  variant?: 'accordion' | 'simple';
  /** Section background style */
  background?: 'default' | 'muted' | 'accent';
}

const {
  title,
  subtitle,
  faqs = [],
  categories = [],
  variant = 'accordion',
  background = 'default',
} = Astro.props;

const bgClass = {
  default: 'bg-background',
  muted: 'bg-surface',
  accent: 'bg-primary/5',
}[background];

const hasHeading = title || subtitle;
const hasCategories = categories.length > 0;
---

<section class:list={['py-section', bgClass]}>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    {
      hasHeading && (
        <div class="text-center mb-12">
          {title && <h2 class="text-2xl sm:text-3xl font-bold text-text">{title}</h2>}
          {subtitle && <p class="mt-4 text-lg text-text-muted">{subtitle}</p>}
        </div>
      )
    }

    {/* Simple FAQ list (no categories) */}
    {
      !hasCategories && faqs.length > 0 && (
        <div class="space-y-6">
          {variant === 'accordion'
            ? faqs.map((faq) => (
                <details class="group">
                  <summary class="flex items-center justify-between cursor-pointer list-none p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors">
                    <span class="font-medium text-text pr-4">{faq.question}</span>
                    <span class="flex-shrink-0 text-text-muted group-open:rotate-180 transition-transform">
                      <Icon name="lucide:chevron-down" class="w-5 h-5" />
                    </span>
                  </summary>
                  <div class="px-4 pt-4 pb-2 text-text-muted leading-relaxed">{faq.answer}</div>
                </details>
              ))
            : faqs.map((faq) => (
                <div class="border-b border-border pb-8 last:border-0">
                  <h3 class="text-lg font-semibold text-text">{faq.question}</h3>
                  <p class="mt-3 text-text-muted leading-relaxed">{faq.answer}</p>
                </div>
              ))}
        </div>
      )
    }

    {/* Categorized FAQs */}
    {
      hasCategories && (
        <div class="space-y-12">
          {categories.map((category, categoryIndex) => (
            <div class:list={[categoryIndex === categories.length - 1 && 'mb-0']}>
              <h2 class="text-xl font-bold text-text mb-6 pb-2 border-b border-border">
                {category.name}
              </h2>
              <div class="space-y-6">
                {variant === 'accordion'
                  ? category.faqs.map((faq) => (
                      <details class="group">
                        <summary class="flex items-center justify-between cursor-pointer list-none p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors">
                          <span class="font-medium text-text pr-4">{faq.question}</span>
                          <span class="flex-shrink-0 text-text-muted group-open:rotate-180 transition-transform">
                            <Icon name="lucide:chevron-down" class="w-5 h-5" />
                          </span>
                        </summary>
                        <div class="px-4 pt-4 pb-2 text-text-muted leading-relaxed">
                          {faq.answer}
                        </div>
                      </details>
                    ))
                  : category.faqs.map((faq) => (
                      <div class="border-b border-border pb-6 last:border-0">
                        <h3 class="text-lg font-semibold text-text">{faq.question}</h3>
                        <p class="mt-3 text-text-muted leading-relaxed">{faq.answer}</p>
                      </div>
                    ))}
              </div>
            </div>
          ))}
        </div>
      )
    }
  </div>
</section>
